# Наблюдаемость системы

Представьте 3–5 метрик, которые будут показывать работоспособность основных сервисов с точки зрения бизнеса.

Процент поисковых запросов на сайте за час - данная метрика показывает работоспособность сайта, интаграции с каталогом товаров (а значит и с корневой системой создания ассортимента мебели) 
Процент оплаченных заказов за час - если процент равен нулю, то это может свидетельствовать о проблемах в интеграциях с системой оплаты/платежными системами/недоступности всего сайта или отдельных его функциональностей для клиента
Процент измененных статусов заказов за час - так как статусная модель заказа затрагивает почти все агрегаты, то данная метрика может позволяет отслеживать общее состояние всей системы магазина, складской системы, системы доставки и оплаты товаров

Системные метрики:
* Утилизация выделенной памяти - мониторим для того, чтобы определить: достаточно ли выдлено памяти для поддержки требуемой бизнес-нагрузки и обработки резких всплесков пользовательской активности. Также по этой метрике можно отследить наличие утечки памяти, которое впоследствии может привести к сбоям в системе
* Производительность сети - следим за скоростью передачи и получения данных сетевым адаптером, информацию о потерянных пакетах или информацию об общей задержке активных сессий. Необходимо отслеживать не только, потому что сетевые задержки приводят к увеличению длительности выполнения запросов, но и отслеживать перегрузку сети и необходимость распределения сетевого трафика
* Использование  CPU - измеряем доступность и загрузку CPU - это позвляет следить за исключениями, блокировками и проблемами в коде, ожидание выполнения синхронных запросов

Опишите, какие подходы к централизованному сбору логов будут применены в системе, и показать почему. 
Для этого задания воспользуйтесь схемой концептуальной архитектуры (см. домашнее задание к модулю 13) и покажите на ней, как будут размещены дополнительные компоненты.

Т.к. в системе используется Kubernetes, то для логирования логично использовать средства Docker на уровне контейнеров. У Docker есть несколько лог-драйверов или плагинов для сбора логов контейнеров. Логи агрегирует Docker Daemon. Логи пишем не внутрь контейнера, а в отдельную БД, развернутую для этого (см. рисуунок ниже). Сохраняем логи между деплоями. Агрегировать логи со всех инстансов, помимо логов с контейнеров собираем логи системы. Парсим логи. Направляем на хранение только логи со статусом «warning» или «error» (для nginx или ingress-контроллеров отправляем на хранение только те, статус которых отличен от 200).
Для мониторинга используем Prometheus. 

Ранее в системе был добавлен агрегат "Сбойные ситуации", обладающий своим  UI для сотрудников, обеспечивающих сопровождение системы. 

![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/apigateway.png)

К данному модулю системы можно добавить логи, метрики, трассировку, чтобы при разборе инцидентов или сбойных ситуаций сотрудник в одном месте мог отследить произошедшие события
Также здесь уместно разместить еще и возможность просмотра метрик, т.к. при проблемах в системе и уведомлениях сотрудник сопровождения также здесь в одном месте может просмотреть метрику, просмотреть логи, и самое главное - здесь же оперативно принять необходимые меры для устранения проблем

Для хранения логов используем БД, отвечающую за (с ней и взаимодействует агрегат "Сбойные ситуации")
Логи можно хранить с глубиной даты не более месяца. За это время сотрудники компании должны произвести расследование инцидентов и принять необходимые меры (ну или хотя бы решения по устранению причин отказов)

Для бизнес-анализа ипользуется система статистики, куда записывается вся необходимая информация и собираемые метрики "на дистанции", поэтому для целей развития бизнеса и изучения коиентского опыта перемешивать логирование для обеспечения технической отказоустойчивости и бизнес-логики не обязательно.

![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/log.png)

БД со статистикой и системными логами исполняем в виде защищенных хранилищ, доступных только из внутренней сети организации - с АРМ сотрудников. Бэкап с основной системной информацией можно хранить, например, в облачном хранилище, с применением механизмов односторонней синхронизации. будем делать резервное копирование на облако с определенной периодичностью (например, на ежедневной основе).

Опишите дальнейшее развитие характеристики наблюдаемости в системе. Какие принципы, правила, рекомендации вы дадите командам разработчиков как архитектор? 
При разработке ПО еще на стадии проектирования необходимо предусматривать отправку сообзений в систему логирования и бойных ситуаций. 
Для этого для систем, которые работают внутри только с сотрудниками предлагается подготовить отдельную библиотеку компонентов, которая может быть переиспользана на проекте разными командами.
Это позволит снизить трудозатраты разработчиков и сделать сообщения единообразными. 
Для систем, работающих с клиентом на сайте требуется подготовить отдельный компонент для сбора логов, который при записи логов и при записи статистики по сайту будет также обезличивать клиентские данные. Для сотрудников этого делать необязательно, т.к. для идентификации можно воспользоваться персональным ID сотрудника и эту информацию уже использовтаь при хранении логов.

