# Инфраструктура с использованием Docker-контейнеров
* Оркестрация посредством Kuberenetes
* Для работы с браузерами и мобильными приложениями клиентов и сотрудников службы доставки используем гео-балансировщик, который будет распределять нагрузку между 2 серверами
* На каждом сервере расположен кластер, включающий в себя несколько модулей для работы с приложениями клиентов и сотрудников службы доставки.  
* Серверы обращаются к двум изоированным БД: клиентов и заказов и создание ассортимента мебели (включает информацию обо всех комплектующих и деталях для единиц мебели)
* Также серверы обращаются к Active Directory и NFS для работы с файлами
* Для сотрудников схема иная: для web-приложений сотрудников реализована клиентская бибилиотека, позволяющая встроить балансировщик непосредственно в сервис. 
* Сотрудники обращаются к отдельному серверу, в котором происходит бизнес-логика в и обращение к базам данных, AD и NFS 
* Помимо пользовательских и внешних БД, сервер 3 обращается к БД внутренних сервисов (содержит информацию о сотрудниках, аудит и тд, не имеющего отношения непосредственно к работе с клиентом)
![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/infra.png)

# Схема деплоя 
* Для деплоя будем использовать канареечные релизы во внешнем контуре (слубжа доставки и клиенты)
* Добавим еще один элемент Kubernetes-оператор Flagger. 
* С его помощью постепенно переключать трафик на канареечный сервер: deployment канареечный и deployment основной для клиентских серверов
* Для сервера сотрудников Flagger накатывает обновления через отдельный основной deployment и при этом используется A/B развертывание с использвоанием feature toggles
* ![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/deploy.png)

# Стратегии выката новых версий
* Для тестиования новой технологии - канареечное развертывание для клиентской функциональности и повторное создание для серверов сотрудников
* Для минорной доработки без времени простоя - канареечное развертывание для клиентской функциональности и А/B развертывание с использвоанием feature toggles для сотрудников
* Для мажорного обновления без обратной совместимости с БД - для клиентской функциональности и сотрудников - А/B развертывание с использвоанием feature toggles

# Стенды для тестирвания 
* ИФТ - полный контур без балансировки, деплой повторным созданием серверов в тех.окно 
* HotFix - полный контур без балансировки, деплой повторным созданием серверов в тех.окно, содержит бэкап БД не более недели (клиентские данные, естественно, зачищены)
* Нагрузочное тестирование - контур с серверами клиентской функциональности (1 и 2), деплой повторным созданием серверов в тех.окно, не имеетсвоей БД - обращается к БД Hotfix на чтение
* ПреПдод - полный контур с балансировкой и схемой деплоя, аналогичной ПРОМ-среде - для тестирования всего ЖЦ работы с версиями приложений 

