# Повышение отказоустойчивости для HTTP-взаимодействия
Добавление товара в заказ: 
1. Пользователь на сайте добавляет товар в заказ 
2. Идет запрос в Систему склада на добавление товаров "Метод POST warehouse/v1/order/products". на вход метода требуется передать:
* oderId - ID заказ
* clientId - ID клиента
* productId - ID товара
* orderDate -  дата и время добавления заказа
* status - статус заказа; возможные значения: placed/approved/delivered
3. Если склад недоступен, то пробуем повторить трижды запрос. 
4. Если неуспешно, то переключаемся на второй сервис складсой системы.
5. Если и он недоступен - возвращаем 500 и сообщаем пользователю об ошибке, предлагаем добавить товар позднее.
6. Склад при получении запроса POST warehouse/v1/order/products запрашивает в "Продуктах", какие комплектующие требуются для выбранного товара
7. В "Продуктах" производится поиск указанного товара. Если ID товара не найден в БД Продуктов, то в складскую систему вовращается соответствующая ошибка 404. 
8. Ошибка отправляется в отдельный сервис по обработке ошибок, который позволяет также производить ручной разбор ошибки
9. Далее кладская система проверяет в своей БД количество комплектующих, доступное к заказу. Если их достаточно, то уменьшает в своей БД это количество на указанное в заказе. Если количество недостаточно, то не считаем это ошибкой и возвращаем кастомный ответ 202 (принято, но товара недостаточно)
10. Если не удалось перезаписать в БД доступное количество товара, то отправляе ошибку в сервис обработки ошибок, чтобы он позднее повторил попытку уменьшить колисетво в БД
11. При этом мы знаем, что товара сейчас достаточно и мы можем добавить его в заказ. Пользваотелю сообщаем об успешном добавлении товара в заказ
![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/httperror.png)

# Повышение отказоуйстойчивости для очереди
Изменение статуса заказа после оплаты: 
1. После успешной оплаты заказа сообщение из системы оплаты поступает в очередь на изменение статуса заказа с "Зарезервировано" на "Оплачено"
2. Сообщение поступает в очередь
3. Если сервис заказов недоступен, то сообщение переносится в DLQ-очередь и из нее уже пробуем обработать сообщение путем серии повторов через 1 минуту
4. Когда сообщение удалось доставить в сервис Заказов, то производится запись в БД заказов
5. При ошибке щаписи в БД из Заказов отправляется сообщение в Обработчик ошибок, который уже будет пробовать сделать запись в БД согласно своей внутренней логике
6. Если заказ не был найден в БД, то отправляется соответсвующая ошибка в обработчик ошибок, который отправляет такую ситуацию на ручной разбор. Сотрудник скалада ищет потерявшийся заказ и сам уже решает, что с ним делать.
![alt tag](https://github.com/chukichaeva/1corns-homework/blob/main/img/queueerror.png)
